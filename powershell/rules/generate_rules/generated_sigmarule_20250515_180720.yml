title: Suspicious Cmd.exe Usage for User Enumeration
id: f2303885-5d56-4295-b077-4a4792352fdb
status: test
description: >
  Detects potential adversary activity using cmd.exe to execute a user enumeration command ("net user /domain"). 
  Legitimate administrative usage is filtered out by verifying that the process working directory is outside common system paths.
author: yusuke
date: 2025-05-15
tags:
  - attack.discovery
  - attack.execution
  - user.enumeration
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    CommandLine|contains:
      - "http"
  filter:
    CurrentDirectory|startswith:
      - "C:\\Windows"
      - "C:\\Program Files"
  condition: selection and not filter
falsepositives:
  - Legitimate administrative or troubleshooting usage of the net user /domain command from system directories.
level: medium