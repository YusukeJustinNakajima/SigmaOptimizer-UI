title: Suspicious 'net user /domain' Execution Outside Standard Directories
id: c6b93979-033e-47cd-a732-d94594c24578
status: test
description: |
  This rule detects execution of a command line containing both "net user" and "/domain" by a process whose original filename is "Cmd.Exe".
  The activity is flagged when the process is initiated from a non-standard working directory (i.e. not from "C:\Windows" or "C:\Program Files"),
  which may indicate an attempt at user enumeration or remote administration by an adversary using obfuscated techniques.
author: [your_name_here]
date: 2025-05-14
tags:
  - attack.discovery
  - attack.execution
  - suspicious.activity
logsource:
  product: windows
  category: process_creation
detection:
  selection:
    EventID: 4688
    OriginalFileName: "Cmd.Exe"
    CommandLine|contains:
      - "net user"
      - "/domain"
  filter:
    CurrentDirectory|startswith:
      - "C:\\Windows"
      - "C:\\Program Files"
  condition: selection and not filter
falsepositives:
  - Legitimate administrative scripts or tools executing domain queries from approved system directories.
level: medium
